# Shelly_adventure
Explore the code, solve the challenges, and embark on a journey of learning.
# TCP Echo Server with ESP-IDF

## Overview

This project implements a TCP Echo Server using the [ESP-IDF](https://docs.espressif.com/projects/esp-idf/en/latest/esp32/index.html) framework for the ESP32 microcontroller. The server accepts TCP connections, receives newline-terminated text messages from clients, and sends them back. The server also tracks the number of connected clients and the number of messages exchanged with each client. Clients can request these statistics by sending a specific command message ("STATS") to the server.

## Project Structure

├── CMakeLists.txt
├── main/
│ ├── CMakeLists.txt
│ ├── main.c
│ ├── tcp_server.c
│ ├── tcp_server.h
│ ├── wifi_init.c
│ ├── wifi_init.h
│ ├── test_tcp_echo_server.c
└── sdkconfig (.gitignore)

- **CMakeLists.txt**: Build configuration file for the project.
- **main/**: Directory containing the main application code and tests.
  - **CMakeLists.txt**: CMake configuration for the main application.
  - **main.c**: Entry point of the application. Initializes NVS and Wi-Fi, then starts the TCP server.
  - **tcp_server.c/h**: Implements the TCP server functionality, including client handling and connection management.
  - **wifi_init.c/h**: Manages the Wi-Fi initialization and connection.
  - **test_tcp_echo_server.c**: Test code for the TCP echo server.
- **sdkconfig**: ESP-IDF project configuration file (generated by `idf.py menuconfig`).

## Code Explanation

### Main Application (main.c)

1. Initializes Non-Volatile Storage (NVS)..
2. Sets up Wi-Fi connection using wifi_init()
3. Starts the TCP server with start_tcp_server().

### TCP Server (tcp_server.c/h)

1. Listens for incoming TCP connections on a specified port.
2. Handles client communication in separate FreeRTOS tasks.
3. Maintains a list of connected clients and their message counts.
4. Provides a simple echo functionality and a "STATS" command to get client statistics.

### Wi-Fi Initialization (wifi_init.c/h)

1. Configures and initializes the Wi-Fi connection.
2. Connects to the specified SSID with given credentials.
 
## Unit Tests

### test_tcp_echo_server.c

This file contains unit tests for the TCP Echo Server using the [Unity framework](https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-guides/unit-testing.html). The test connects to the echo server, sends a message, and verifies that the same message is received back.
 
## Good Practices

1. **Thread Safety**: Use mutexes to ensure thread-safe access to shared resources.
2. **Error Handling**: Check and handle errors for all critical operations.
3. **Modularity**: Separate different functionalities into functions and files.

## References

- [TCP Server](https://github.com/espressif/esp-idf/tree/master/examples/protocols/sockets/tcp_server)
- [Wifi Example](https://github.com/espressif/esp-idf/tree/master/examples/wifi)
- [Wi-Fi Driver](https://docs.espressif.com/projects/esp-idf/en/stable/esp32/api-guides/wifi.html)
- [Wi-Fi](https://docs.espressif.com/projects/esp-idf/en/stable/esp32/api-reference/network/esp_wifi.html)
